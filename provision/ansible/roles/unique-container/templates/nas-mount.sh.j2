#!/bin/sh
sudo wakeonlan {{ media_wol_address }}
sudo mkdir --parents {{ media_mount }}

WAIT_ITERATIONS=0
echo "Waiting for {{ media_ip_address }} to come online..."
while ! ping -c 1 -W 1 "{{ media_ip_address }}" >/dev/null 2>&1; do
  sleep 10
  echo "Waiting... ${WAIT_ITERATIONS++}"
done

sudo mount -t cifs -o ro,vers=3.0,credentials={{ media_credentials_file }} {{ media_location }} {{ media_mount }}
